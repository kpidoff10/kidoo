---
description: "Règles de navigation pour kidoo-app. Utiliser Expo Router avec file-based routing, laisser _layout.tsx gérer la protection des routes, et utiliser NavigationContext pour le header dynamique."
alwaysApply: false
globs:
  - kidoo-app/app/**/*.tsx
  - kidoo-app/contexts/NavigationContext.tsx
  - kidoo-app/components/themes/header.tsx
---

# Règles du Module Navigation

## Architecture

Le projet utilise **Expo Router** avec file-based routing :
- Routes définies par la structure de fichiers dans `app/`
- Navigation programmatique avec `useRouter()`
- Protection des routes via `_layout.tsx`

## Structure des routes

```
app/
├── _layout.tsx           # Layout racine avec protection auth
├── (auth)/               # Groupe de routes auth (non protégé)
│   ├── _layout.tsx
│   ├── login.tsx
│   └── register.tsx
├── (tabs)/               # Groupe de routes tabs (protégé)
│   ├── _layout.tsx
│   ├── index.tsx         # Tab "Home"
│   ├── explore.tsx       # Tab "Explore"
│   └── kidoos.tsx        # Tab "Mes Kidoos"
└── modal.tsx             # Route modale
```

## Navigation programmatique

```tsx
import { useRouter } from 'expo-router';

const router = useRouter();

// Navigation
router.push('/(tabs)/kidoos');
router.replace('/(auth)/login');  // Remplace l'historique
router.back();                    // Retour en arrière
```

## Header dynamique

Le header affiche automatiquement le nom de l'onglet actif via `NavigationContext` :

```tsx
// Dans contexts/NavigationContext.tsx
// Le titre est automatiquement déterminé depuis les segments de route
```

**Règle** : Le header s'adapte automatiquement, pas besoin de le configurer manuellement.

## Protection des routes

La protection est gérée dans `app/_layout.tsx` :

```tsx
// Redirection automatique
if (!isAuthenticated && !inAuthGroup) {
  router.replace('/(auth)/login');
} else if (isAuthenticated && inAuthGroup) {
  router.replace('/(tabs)');
}
```

**Règle** : Ne pas créer de guards manuels, utiliser le système existant.

## Composants de navigation

### TabScreen

Pour les écrans dans les tabs :

```tsx
import { TabScreen } from '@/components/screen';

export default function MonEcran() {
  return (
    <TabScreen>
      {/* Contenu */}
    </TabScreen>
  );
}
```

### Header

Le header est automatiquement inclus dans `TabScreen`. Pour l'utiliser manuellement :

```tsx
import { Header } from '@/components/themes/header';

<Header />
```

## Navigation entre écrans auth

```tsx
// Dans login.tsx
<AuthLink
  prompt={t('auth.login.noAccount')}
  linkText={t('auth.login.signUp')}
  onPress={() => router.push('/(auth)/register')}
/>
```

## Navigation vers les détails

Pour naviguer vers les détails d'un Kidoo (exemple) :

```tsx
const router = useRouter();

const handleKidooPress = (kidoo: Kidoo) => {
  router.push(`/(tabs)/kidoos/${kidoo.id}`);
};
```

## Règles strictes

1. **Utiliser Expo Router** - Pas de navigation manuelle avec React Navigation
2. **File-based routing** - Les routes suivent la structure de fichiers
3. **Protection automatique** - Laisser `_layout.tsx` gérer les redirections
4. **Header automatique** - Utiliser `TabScreen` qui inclut le header
5. **NavigationContext** - Le titre du header est géré automatiquement
